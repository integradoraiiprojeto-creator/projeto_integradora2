<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>MonitorMed ‚Ä¢ Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#020617,#0f172a);
  color:#e5e7eb;
  min-height:100vh
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 30px;
  background:rgba(2,6,23,.9);
  backdrop-filter:blur(10px);
  border-bottom:1px solid rgba(56,189,248,.2)
}

header h2{color:#38bdf8}
header button{
  background:rgba(239,68,68,.2);
  border:1px solid rgba(239,68,68,.5);
  color:#ef4444;
  padding:10px 18px;
  border-radius:10px;
  cursor:pointer
}

main{
  display:grid;
  grid-template-columns:380px 1fr;
  gap:30px;
  padding:30px
}

.card{
  background:rgba(2,6,23,.85);
  border-radius:20px;
  padding:25px;
  box-shadow:0 20px 60px rgba(0,0,0,.6);
  animation:fadeUp .6s ease
}

@keyframes fadeUp{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:none}}

.sensor{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:18px 0;
  padding:18px;
  border-radius:14px;
  background:rgba(15,23,42,.8);
  transition:.3s
}
.sensor:hover{transform:translateY(-4px)}
.valor{font-size:1.6rem;font-weight:700}

.table{
  width:100%;
  border-collapse:collapse
}
.table th,.table td{
  padding:14px;
  border-bottom:1px solid rgba(56,189,248,.15)
}
.table th{color:#38bdf8;text-align:left}

@media(max-width:1100px){
  main{grid-template-columns:1fr}
}
</style>
</head>
<body>
<header>
  <h2><i class="fas fa-heart-pulse"></i> Monitoramento</h2>
  <button onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</button>
</header>

<main>
  <div class="card">
    <h3>Paciente</h3>
    <p id="paciente">---</p>

    <div class="sensor"><span><i class="fas fa-heart"></i> FC</span><span class="valor" id="fc">--</span></div>
    <div class="sensor"><span><i class="fas fa-tint"></i> Oxi</span><span class="valor" id="oxi">--</span></div>
    <div class="sensor"><span><i class="fas fa-thermometer-half"></i> Temp</span><span class="valor" id="temp">--</span></div>
  </div>

  <div class="card">
    <h3>Hist√≥rico</h3>
    <canvas id="grafico" height="140"></canvas>
    <table class="table">
      <thead><tr><th>Hora</th><th>FC</th><th>Oxi</th><th>Temp</th></tr></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  // üî• CONFIGURA√á√ÉO FIREBASE (a mesma do seu projeto)
  const firebaseConfig = {
    apiKey: "AIzaSyDURF1Z7S-O0y1mfc0Sf8sjY9KGLJwkYHY",
    authDomain: "projeto-integradora-ii.firebaseapp.com",
    databaseURL: "https://projeto-integradora-ii-default-rtdb.firebaseio.com",
    projectId: "projeto-integradora-ii",
    storageBucket: "projeto-integradora-ii.firebasestorage.app",
    messagingSenderId: "80939508930",
    appId: "1:80939508930:web:9a2d2f9bf97be9eb98075b"
  };

  // Inicializar Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Logout
  window.logout = () => {
    sessionStorage.clear();
    location.href = 'index.html';
  };

  // Elementos
  const el = {
    paciente: document.getElementById('paciente'),
    fc: document.getElementById('fc'),
    oxi: document.getElementById('oxi'),
    temp: document.getElementById('temp'),
    tbody: document.getElementById('tbody')
  };

  // üîπ PACIENTE
  onValue(ref(db, 'Paciente'), snap => {
    const p = snap.val();
    if (p) el.paciente.textContent = `${p.nome} (${p.id_paciente})`;
  });

  // üîπ SENSORES ATUAIS
  onValue(ref(db, 'sensores_atuais'), snap => {
    const s = snap.val();
    if (!s) return;

    el.fc.textContent = s.freq_cardiaca + ' bpm';
    el.oxi.textContent = s.oximetria + ' %';
    el.temp.textContent = s.temperatura + ' ¬∞C';
  });

  // üîπ HIST√ìRICO + GR√ÅFICO
  const ctx = document.getElementById('grafico');
  let chart;

  onValue(ref(db, 'sensores_historico'), snap => {
    const dados = snap.val();
    if (!dados) return;

    const labels = [];
    const freq = [];
    el.tbody.innerHTML = '';

    Object.entries(dados.freq_cardiaca || {}).slice(-10).forEach(([hora, valores]) => {
      Object.values(valores).forEach(v => {
        labels.push(hora.split('_')[1].replace(/-/g, ':'));
        freq.push(v);

        el.tbody.innerHTML += `
          <tr>
            <td>${hora.replace('_', ' ')}</td>
            <td>${v}</td>
            <td>--</td>
            <td>--</td>
          </tr>`;
      });
    });

    if (chart) chart.destroy();

    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels,
        datasets: [{
          label: 'Frequ√™ncia Card√≠aca',
          data: freq,
          borderColor: '#ef4444',
          tension: .4
        }]
      },
      options: {
        plugins: { legend: { labels: { color: '#e5e7eb' } } },
        scales: {
          x: { ticks: { color: '#94a3b8' } },
          y: { ticks: { color: '#94a3b8' } }
        }
      }
    });
  });
</script>
</body>
</html>
